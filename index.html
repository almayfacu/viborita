<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Viborita Enamoralma</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #ffe6f0;
      font-family: 'Segoe UI', 'Arial', sans-serif;
      height: 100%;
      overflow: hidden;
      touch-action: none;
    }

    .juego-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    h1 {
      color: #ff66a3;
      margin: 20px 0 10px;
      text-align: center;
    }

    #info {
      font-size: 1.2em;
      margin-bottom: 8px;
      text-align: center;
    }

    #board {
      background: #fff0f5;
      border: 4px solid #ff99cc;
      box-shadow: 0 0 20px #ff99cc;
      touch-action: none;
    }

    canvas {
      width: 90vmin;
      height: 90vmin;
      max-width: 480px;
      max-height: 480px;
      display: block;
      margin: 0 auto;
    }

    #overlay img {
      max-width: 90vw;
      max-height: 60vh;
      border-radius: 16px;
      box-shadow: 0 0 25px rgba(0,0,0,0.6);
      animation: pulse 2s infinite;
      margin-bottom: 20px;
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      z-index: 20;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
    }

    #restartWin, #restart {
      padding: 14px 28px;
      font-size: 1.1em;
      background: linear-gradient(to right, #ff66a3, #ff99cc);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 0 15px #ff99cc;
      transition: transform 0.2s, box-shadow 0.3s;
    }

    #restartWin:hover, #restart:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px #ff66a3;
    }

    #loseContainer {
      margin-top: 15px;
      text-align: center;
      display: none;
      flex-direction: column;
      gap: 10px;
    }

    #loseMsg {
      font-size: 2em;
      color: #ff3366;
    }

    #startScreen {
      position: fixed;
      inset: 0;
      background: #fff0f5;
      z-index: 50;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100svh;
      padding: 20px;
      text-align: center;
      gap: 20px;
    }

    #startScreen h1 {
      font-size: 2em;
      font-weight: 700;
      max-width: 90%;
    }

    #startBtn {
      padding: 12px 24px;
      font-size: 1.2em;
      background: #ff66a3;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 10px #ff99cc;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
  </style>
</head>
<body>

  <div id="startScreen">
    <h1>Viborita Enamoralma</h1>
    <button id="startBtn">Iniciar Juego</button>
  </div>

  <div class="juego-wrapper">
    <h1 style="display:none">Viborita Enamoralma</h1>
    <div id="info" style="display:none">
      ‚è± <span id="timer">0</span>s‚ÄÇ|‚ÄÇüß° Faltan <span id="remain">10</span>
    </div>
    <canvas id="board" width="480" height="480"></canvas>

    <div id="loseContainer">
      <div id="loseMsg">Perdiste :(</div>
      <button id="restart">Volver a jugar</button>
    </div>
  </div>

  <div id="overlay">
    <img src="sorpresas.png" alt="¬°Ganaste!">
    <button id="restartWin">Volver a jugar</button>
  </div>

  <audio id="sndMove" src="movimiento.mp3"></audio>
  <audio id="sndEat"  src="comida.mp3"></audio>
  <audio id="sndWin"  src="victoria.mp3"></audio>
  <audio id="sndGameOver" src="go.mp3"></audio>

  <script>
    let GRID_SIZE = 8;
    let CELL;
    const TOTAL_FOOD = 10;
    const SPEED_MS = 260;

    const cvs = document.getElementById('board');
    const ctx = cvs.getContext('2d');
    const timeEl = document.getElementById('timer');
    const remEl = document.getElementById('remain');
    const moveSound = document.getElementById('sndMove');
    const eatSound = document.getElementById('sndEat');
    const winSound = document.getElementById('sndWin');
    const loseSound = document.getElementById('sndGameOver');
    const overlay = document.getElementById('overlay');
    const loseContainer = document.getElementById('loseContainer');
    const restart = document.getElementById('restart');
    const restartWin = document.getElementById('restartWin');
    const startScreen = document.getElementById('startScreen');
    const startBtn = document.getElementById('startBtn');
    const title = document.querySelector('h1');
    const info = document.getElementById('info');

    let snake, dir, food, eaten, gameInterval, clockInterval, gameOver;

    const imgHead = new Image(); imgHead.src = 'alma.png';
    const imgBody = new Image(); imgBody.src = 'alma.png';
    const imgFood = new Image(); imgFood.src = 'facu.png';

    function initCanvasSize() {
      const size = Math.min(window.innerWidth, window.innerHeight) * 0.9;
      cvs.width = size;
      cvs.height = size;
      CELL = cvs.width / GRID_SIZE;
    }

    function init(){
      initCanvasSize();
      snake = [{ x: Math.floor(GRID_SIZE/2), y: Math.floor(GRID_SIZE/2) }];
      dir = { x: 1, y: 0 };
      food = randomPos();
      eaten = 0;
      gameOver = false;
      timeEl.textContent = '0';
      remEl.textContent = TOTAL_FOOD;
      overlay.style.display = 'none';
      loseContainer.style.display = 'none';
      title.style.display = 'block';
      info.style.display = 'block';
      startClock();
      clearInterval(gameInterval);
      gameInterval = setInterval(loop, SPEED_MS);
      draw();
    }

    function randomPos(){
      let p;
      do {
        p = { x: Math.floor(Math.random() * GRID_SIZE), y: Math.floor(Math.random() * GRID_SIZE) };
      } while(snake.some(s => s.x === p.x && s.y === p.y));
      return p;
    }

    function drawBackground(){
      const green1 = '#7cfc00';
      const green2 = '#66c426';
      for(let x = 0; x < GRID_SIZE; x++){
        for(let y = 0; y < GRID_SIZE; y++){
          ctx.fillStyle = (x + y) % 2 === 0 ? green1 : green2;
          ctx.fillRect(x * CELL, y * CELL, CELL, CELL);
        }
      }
    }

    function draw(){
      drawBackground();
      ctx.drawImage(imgFood, food.x * CELL, food.y * CELL, CELL, CELL);
      const t = Date.now() / 200;
      snake.forEach((seg, i) => {
        const x = seg.x * CELL, y = seg.y * CELL;
        if (i === 0) {
          ctx.drawImage(imgHead, x, y, CELL, CELL);
        } else {
          const scale = 1 + 0.1 * Math.sin(t + i);
          const w = CELL * scale, h = CELL * scale;
          const dx = x + (CELL - w) / 2, dy = y + (CELL - h) / 2;
          ctx.save();
          ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
          ctx.shadowBlur = 8;
          ctx.shadowOffsetX = 4;
          ctx.shadowOffsetY = 4;
          ctx.drawImage(imgBody, dx, dy, w, h);
          ctx.restore();
        }
      });
    }

    function loop(){
      const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
      if (
        head.x < 0 || head.y < 0 ||
        head.x >= GRID_SIZE || head.y >= GRID_SIZE ||
        snake.some(s => s.x === head.x && s.y === head.y)
      ) return end(false);

      snake.unshift(head);
      if (head.x === food.x && head.y === food.y) {
        eaten++;
        remEl.textContent = TOTAL_FOOD - eaten;
        eatSound.play();
        if (eaten >= TOTAL_FOOD) return end(true);
        food = randomPos();
      } else {
        snake.pop();
        moveSound.play();
      }
      draw();
    }

    function startClock(){
      clearInterval(clockInterval);
      let sec = 0;
      clockInterval = setInterval(() => {
        sec++;
        timeEl.textContent = sec;
      }, 1000);
    }

    function end(won){
      clearInterval(gameInterval);
      clearInterval(clockInterval);
      gameOver = true;
      if (won) {
        winSound.play();
        overlay.style.display = 'flex';
      } else {
        loseSound.play();
        loseContainer.style.display = 'flex';
      }
      info.style.display = 'none';
      title.style.display = 'none';
    }

    function stopAllSounds() {
      [winSound, moveSound, eatSound, loseSound].forEach(snd => {
        snd.pause();
        snd.currentTime = 0;
      });
    }

    document.addEventListener('keydown', e => {
      if (gameOver) return;
      if (e.key === 'ArrowUp'    && dir.y === 0) dir = { x: 0, y: -1 };
      if (e.key === 'ArrowDown'  && dir.y === 0) dir = { x: 0, y:  1 };
      if (e.key === 'ArrowLeft'  && dir.x === 0) dir = { x:-1, y:  0 };
      if (e.key === 'ArrowRight' && dir.x === 0) dir = { x: 1, y:  0 };
    });

    let startX, startY;
    cvs.addEventListener("touchstart", e => {
      const touch = e.touches[0];
      startX = touch.clientX;
      startY = touch.clientY;
    }, false);

    cvs.addEventListener("touchend", e => {
      if (gameOver) return;
      const touch = e.changedTouches[0];
      const dx = touch.clientX - startX;
      const dy = touch.clientY - startY;
      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 0 && dir.x === 0) dir = { x: 1, y: 0 };
        else if (dx < 0 && dir.x === 0) dir = { x: -1, y: 0 };
      } else {
        if (dy > 0 && dir.y === 0) dir = { x: 0, y: 1 };
        else if (dy < 0 && dir.y === 0) dir = { x: 0, y: -1 };
      }
    }, false);

    restart.addEventListener('click', () => {
      stopAllSounds();
      init();
    });

    restartWin.addEventListener('click', () => {
      stopAllSounds();
      init();
    });

    startBtn.addEventListener('click', () => {
      startScreen.style.display = 'none';
      init();
    });

    window.addEventListener('resize', () => {
      initCanvasSize();
      draw();
    });

    document.addEventListener('touchmove', function(e) {
      e.preventDefault();
    }, { passive: false });
  </script>
</body>
</html>
